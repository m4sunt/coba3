<!-- Overlay putih transparan -->
<div id="lockOverlay" style="display:none; position:fixed; top:0; left:0; width:100%; height:100%; background:rgba(255,255,255,0.95); z-index:9999; display:flex; flex-direction:column; justify-content:center; align-items:center; text-align:center; padding:20px;">
    <h2 style="color:#dc3545; margin-bottom:10px;">⚠️ Aplikasi Belum Ditambahkan ke Layar Utama</h2>
    <p style="margin-bottom:20px;">Silakan tambahkan ke layar utama untuk menggunakan aplikasi ini.</p>
    <button id="btnOverlayInstall" style="padding:12px 20px; font-size:16px; background:#28a745; color:white; border:none; border-radius:8px;">📲 Tambahkan ke Layar Utama</button>
</div>

<script>
    let deferredPrompt = null;

    function isInStandaloneMode() {
        return window.matchMedia('(display-mode: standalone)').matches || window.navigator.standalone === true;
    }

    // Tampilkan tombol install jika belum PWA
    window.addEventListener('beforeinstallprompt', (e) => {
        e.preventDefault();
        deferredPrompt = e;
        if (!isInStandaloneMode()) {
            document.getElementById('lockOverlay').style.display = 'flex';
        }
    });

    // Blok seluruh form kalau belum ditambahkan ke layar utama
    window.addEventListener('DOMContentLoaded', () => {
        if (!isInStandaloneMode()) {
            document.getElementById('lockOverlay').style.display = 'flex';

            // Nonaktifkan semua elemen input dan tombol
            const elemen = document.querySelectorAll('input, select, button, canvas, textarea');
            elemen.forEach(el => {
                if (el.id === "btnOverlayInstall") return; // biarkan tombol install aktif
                if (el.tagName === 'CANVAS') {
                    el.style.pointerEvents = 'none';
                    el.style.opacity = '0.3';
                } else {
                    el.disabled = true;
                }
            });
        }
    });

    // Klik tombol install
    document.getElementById('btnOverlayInstall').addEventListener('click', async () => {
        if (deferredPrompt) {
            deferredPrompt.prompt();
            const { outcome } = await deferredPrompt.userChoice;
            if (outcome === 'accepted') {
                document.getElementById('lockOverlay').style.display = 'none';
            }
            deferredPrompt = null;
        } else {
            alert('📌 Jika tombol sistem tidak muncul, gunakan fitur “Tambahkan ke layar utama” dari menu browser.');
        }
    });
</script>
